# Nilou
一个自娱自乐的实时渲染引擎  
![](figures/nilou.png)
_她真的好美_
## Overview

原先是我的毕业设计，毕业设计中实现了pbr（部分）、GPU Driven的地形系统（还没搞VT）、大气渲染（还有bug）、FFT海面（这个倒是很完整）  
毕业项目的链接：https://pan.baidu.com/s/104S4944MNkbFUYGAdGSm5A?pwd=y4ws  
提取码：y4ws  
后来我觉得这个还有再继续做下去的价值，可以变成我试验各种图形学算法的游乐场，但是我发现这个项目当时的架构根本就没什么可扩展性，因此开始了长达4个月的重构之旅。  
重构选用了xmake作为构建工具。在重构中我尽量尝试模仿虚幻引擎的Actor和组件机制以及渲染体系，虽然依然很丑，但是已经有了那么一点样子。
## 运行
```sh
xmake build -v Nilou  
xmake run Nilou
```
## 相较于毕设多了哪些
- 简单的侵入式反射，可以查询类的继承关系，可以根据名称创建类的对象
- 对顶点着色器、片元着色器的抽象。现在顶点着色器和片元着色器都是MaterialShader，其本身是不完整的。顶点着色器还需要顶点工厂和材质，片元着色器还需要材质，才能构成一个完整的着色器，而顶点工厂和材质则需要实现一系列接口。
- 一个比较完备的场景管理架构。现在参照虚幻引擎搭建了Actor和Component的架构，使得整个项目更有扩展性。
- 分离的逻辑线程和渲染线程，两个线程使用一些同步手段，使得渲染线程不会落后于逻辑线程超过1帧。
- 对顶点工厂、材质、着色器使用glslang库进行解析，生成一些反射信息，帮助进行资源的绑定。整个过程类似于这样：在渲染端保存一个map，key为变量名称，value为binding point；逻辑端需要提供另一个map作为输入，key为变量名称，value为各种资源。渲染时渲染端根据自己的map，去到输入的map中名称对应的资源。
- Cascaded Shadow Map，PCF软阴影。CSM默认使用8级，前4级每帧更新，后4级轮流更新。
## 相较于毕设还少了哪些
- 水下散射
## TODO
- 全局光照
- 屏幕空间反射
- TAA
- ......